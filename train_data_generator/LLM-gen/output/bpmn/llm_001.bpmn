<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
             xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"
             xmlns:dc="http://www.omg.org/spec/DD/20100524/DC"
             xmlns:di="http://www.omg.org/spec/DD/20100524/DI"
             id="definitions_1"
             targetNamespace="http://bpmn.io/schema/bpmn">
  
  <process id="process_pokupatel" isExecutable="false">
    <startEvent id="start_pokupatel" name="Начало процесса покупки">
      <outgoing>flow_1</outgoing>
    </startEvent>
    
    <userTask id="task_vybor_tovarov" name="Выбор товаров и добавление в корзину">
      <incoming>flow_1</incoming>
      <outgoing>flow_2</outgoing>
    </userTask>
    
    <userTask id="task_oformlenie_zakaza" name="Оформление заказа и указание адреса">
      <incoming>flow_2</incoming>
      <outgoing>flow_3</outgoing>
    </userTask>
    
    <endEvent id="end_pokupatel" name="Завершение процесса покупки">
      <incoming>flow_14</incoming>
    </endEvent>
    
    <userTask id="task_vybor_oplaty" name="Выбор способа оплаты">
      <incoming>flow_6</incoming>
      <outgoing>flow_7</outgoing>
    </userTask>
    
    <userTask id="task_oplata_pri_poluchenii" name="Оплата при получении">
      <incoming>flow_9</incoming>
      <outgoing>flow_10</outgoing>
    </userTask>
    
    <userTask id="task_podtverzhdenie_polucheniya" name="Подтверждение получения товара">
      <incoming>flow_11</incoming>
      <outgoing>flow_14</outgoing>
    </userTask>
    
    <exclusiveGateway id="gateway_vybor_oplaty" name="Выбор способа оплаты">
      <incoming>flow_7</incoming>
      <outgoing>flow_8</outgoing>
      <outgoing>flow_9</outgoing>
    </exclusiveGateway>
    
    <sequenceFlow id="flow_1" sourceRef="start_pokupatel" targetRef="task_vybor_tovarov"/>
    <sequenceFlow id="flow_2" sourceRef="task_vybor_tovarov" targetRef="task_oformlenie_zakaza"/>
    <sequenceFlow id="flow_3" sourceRef="task_oformlenie_zakaza" targetRef="message_flow_1"/>
    <sequenceFlow id="flow_6" sourceRef="message_flow_2" targetRef="task_vybor_oplaty"/>
    <sequenceFlow id="flow_7" sourceRef="task_vybor_oplaty" targetRef="gateway_vybor_oplaty"/>
    <sequenceFlow id="flow_8" sourceRef="gateway_vybor_oplaty" targetRef="message_flow_3"/>
    <sequenceFlow id="flow_9" sourceRef="gateway_vybor_oplaty" targetRef="task_oplata_pri_poluchenii"/>
    <sequenceFlow id="flow_10" sourceRef="task_oplata_pri_poluchenii" targetRef="message_flow_5"/>
    <sequenceFlow id="flow_11" sourceRef="message_flow_6" targetRef="task_podtverzhdenie_polucheniya"/>
    <sequenceFlow id="flow_14" sourceRef="task_podtverzhdenie_polucheniya" targetRef="end_pokupatel"/>
  </process>
  
  <process id="process_sistema" isExecutable="false">
    <startEvent id="start_sistema" name="Получение заказа от покупателя">
      <outgoing>flow_15</outgoing>
    </startEvent>
    
    <serviceTask id="task_proverka_nalichiya" name="Проверка наличия товара">
      <incoming>flow_15</incoming>
      <outgoing>flow_16</outgoing>
    </serviceTask>
    
    <exclusiveGateway id="gateway_nalichie" name="Проверка наличия товара">
      <incoming>flow_16</incoming>
      <outgoing>flow_17</outgoing>
      <outgoing>flow_18</outgoing>
    </exclusiveGateway>
    
    <serviceTask id="task_rezerv_tovara" name="Резервирование товара">
      <incoming>flow_17</incoming>
      <outgoing>flow_19</outgoing>
    </serviceTask>
    
    <serviceTask id="task_predlozhenie_alternativ" name="Предложение альтернативных товаров">
      <incoming>flow_18</incoming>
      <outgoing>flow_20</outgoing>
    </serviceTask>
    
    <parallelGateway id="gateway_parallel_split" name="Параллельная обработка">
      <incoming>flow_19</incoming>
      <outgoing>flow_21</outgoing>
      <outgoing>flow_22</outgoing>
    </parallelGateway>
    
    <serviceTask id="task_formirovanie_nakladnoy" name="Формирование накладной">
      <incoming>flow_21</incoming>
      <outgoing>flow_23</outgoing>
    </serviceTask>
    
    <serviceTask id="task_otpravka_v_dostavku" name="Отправка информации в службу доставки">
      <incoming>flow_22</incoming>
      <outgoing>flow_24</outgoing>
    </serviceTask>
    
    <parallelGateway id="gateway_parallel_join" name="Объединение параллельных потоков">
      <incoming>flow_23</incoming>
      <incoming>flow_24</incoming>
      <outgoing>flow_25</outgoing>
    </parallelGateway>
    
    <serviceTask id="task_obrabotka_platezha" name="Обработка онлайн платежа">
      <incoming>flow_26</incoming>
      <outgoing>flow_27</outgoing>
    </serviceTask>
    
    <serviceTask id="task_sozdanie_zakaza" name="Создание заказа">
      <incoming>flow_25</incoming>
      <incoming>flow_27</incoming>
      <outgoing>flow_28</outgoing>
    </serviceTask>
    
    <serviceTask id="task_zakrytie_zakaza" name="Закрытие заказа">
      <incoming>flow_29</incoming>
      <outgoing>flow_30</outgoing>
    </serviceTask>
    
    <endEvent id="end_sistema" name="Завершение обработки заказа">
      <incoming>flow_30</incoming>
    </endEvent>
    
    <intermediateThrowEvent id="event_uvedomlenie" name="Уведомление покупателя">
      <incoming>flow_28</incoming>
      <outgoing>flow_31</outgoing>
    </intermediateThrowEvent>
    
    <sequenceFlow id="flow_15" sourceRef="start_sistema" targetRef="task_proverka_nalichiya"/>
    <sequenceFlow id="flow_16" sourceRef="task_proverka_nalichiya" targetRef="gateway_nalichie"/>
    <sequenceFlow id="flow_17" sourceRef="gateway_nalichie" targetRef="task_rezerv_tovara" name="Товар в наличии"/>
    <sequenceFlow id="flow_18" sourceRef="gateway_nalichie" targetRef="task_predlozhenie_alternativ" name="Товара нет в наличии"/>
    <sequenceFlow id="flow_19" sourceRef="task_rezerv_tovara" targetRef="gateway_parallel_split"/>
    <sequenceFlow id="flow_20" sourceRef="task_predlozhenie_alternativ" targetRef="end_sistema"/>
    <sequenceFlow id="flow_21" sourceRef="gateway_parallel_split" targetRef="task_formirovanie_nakladnoy"/>
    <sequenceFlow id="flow_22" sourceRef="gateway_parallel_split" targetRef="task_otpravka_v_dostavku"/>
    <sequenceFlow id="flow_23" sourceRef="task_formirovanie_nakladnoy" targetRef="gateway_parallel_join"/>
    <sequenceFlow id="flow_24" sourceRef="task_otpravka_v_dostavku" targetRef="gateway_parallel_join"/>
    <sequenceFlow id="flow_25" sourceRef="gateway_parallel_join" targetRef="task_sozdanie_zakaza"/>
    <sequenceFlow id="flow_26" sourceRef="message_flow_4" targetRef="task_obrabotka_platezha"/>
    <sequenceFlow id="flow_27" sourceRef="task_obrabotka_platezha" targetRef="task_sozdanie_zakaza"/>
    <sequenceFlow id="flow_28" sourceRef="task_sozdanie_zakaza" targetRef="event_uvedomlenie"/>
    <sequenceFlow id="flow_29" sourceRef="message_flow_7" targetRef="task_zakrytie_zakaza"/>
    <sequenceFlow id="flow_30" sourceRef="task_zakrytie_zakaza" targetRef="end_sistema"/>
    <sequenceFlow id="flow_31" sourceRef="event_uvedomlenie" targetRef="message_flow_2"/>
  </process>
  
  <process id="process_dostavka" isExecutable="false">
    <startEvent id="start_dostavka" name="Получение заказа от системы">
      <outgoing>flow_32</outgoing>
    </startEvent>
    
    <serviceTask id="task_planirovanie_marshruta" name="Планирование маршрута доставки">
      <incoming>flow_32</incoming>
      <outgoing>flow_33</outgoing>
    </serviceTask>
    
    <serviceTask id="task_dostavka_tovara" name="Доставка товара покупателю">
      <incoming>flow_33</incoming>
      <outgoing>flow_34</outgoing>
    </serviceTask>
    
    <endEvent id="end_dostavka" name="Завершение доставки">
      <incoming>flow_34</incoming>
    </endEvent>
    
    <sequenceFlow id="flow_32" sourceRef="start_dostavka" targetRef="task_planirovanie_marshruta"/>
    <sequenceFlow id="flow_33" sourceRef="task_planirovanie_marshruta" targetRef="task_dostavka_tovara"/>
    <sequenceFlow id="flow_34" sourceRef="task_dostavka_tovara" targetRef="end_dostavka"/>
  </process>
  
  <messageFlow id="message_flow_1" sourceRef="task_oformlenie_zakaza" targetRef="start_sistema"/>
  <messageFlow id="message_flow_2" sourceRef="event_uvedomlenie" targetRef="task_vybor_oplaty"/>
  <messageFlow id="message_flow_3" sourceRef="gateway_vybor_oplaty" targetRef="task_obrabotka_platezha"/>
  <messageFlow id="message_flow_4" sourceRef="gateway_vybor_oplaty" targetRef="task_obrabotka_platezha"/>
  <messageFlow id="message_flow_5" sourceRef="task_oplata_pri_poluchenii" targetRef="task_dostavka_tovara"/>
  <messageFlow id="message_flow_6" sourceRef="task_dostavka_tovara" targetRef="task_podtverzhdenie_polucheniya"/>
  <messageFlow id="message_flow_7" sourceRef="task_podtverzhdenie_polucheniya" targetRef="task_zakrytie_zakaza"/>
  
  <bpmndi:BPMNDiagram id="diagram_1">
    <bpmndi:BPMNPlane id="plane_1" bpmnElement="process_1">
      <bpmndi:BPMNShape id="shape_start_pokupatel" bpmnElement="start_pokupatel">
        <dc:Bounds x="15" y="100" width="30" height="30"/>
      </bpmndi:BPMNShape>
      
      <bpmndi:BPMNShape id="shape_task_vybor_tovarov" bpmnElement="task_vybor_tovarov">
        <dc:Bounds x="80" y="75" width="100" height="80"/>
      </bpmndi:BPMNShape>
      
      <bpmndi:BPMNShape id="shape_task_oformlenie_zakaza" bpmnElement="task_oformlenie_zakaza">
        <dc:Bounds x="220" y="75" width="100" height="80"/>
      </bpmndi:BPMNShape>
      
      <bpmndi:BPMNShape id="shape_end_pokupatel" bpmnElement="end_pokupatel">
        <dc:Bounds x="800" y="100" width="30" height="30"/>
      </bpmndi:BPMNShape>
      
      <bpmndi:BPMNShape id="shape_start_sistema" bpmnElement="start_sistema">
        <dc:Bounds x="15" y="250" width="30" height="30"/>
      </bpmndi:BPMNShape>
      
      <bpmndi:BPMNShape id="shape_start_dostavka" bpmnElement="start_dostavka">
        <dc:Bounds x="15" y="400" width="30" height="30"/>
      </bpmndi:BPMNShape>
      
      <bpmndi:BPMNShape id="shape_end_sistema" bpmnElement="end_sistema">
        <dc:Bounds x="800" y="250" width="30" height="30"/>
      </bpmndi:BPMNShape>
      
      <bpmndi:BPMNShape id="shape_end_dostavka" bpmnElement="end_dostavka">
        <dc:Bounds x="800" y="400" width="30" height="30"/>
      </bpmndi:BPMNShape>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
  
</definitions>