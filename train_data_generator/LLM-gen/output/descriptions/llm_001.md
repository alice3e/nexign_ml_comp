# Алгоритм: Процесс покупки товара в интернет-магазине

## Пул: Покупатель

### Основной поток

1. START (Начало процесса покупки)
2. Выбор товаров и добавление в корзину
3. Оформление заказа и указание адреса
4. Ожидание ответа от системы
5. Выбор способа оплаты
6. XOR_SPLIT (условие: способ оплаты)
   - ЕСЛИ онлайн оплата:
     7a. Отправка информации об онлайн оплате
   - ИНАЧЕ оплата при получении:
     7b. Оплата при получении
8. Подтверждение получения товара
9. END (Завершение процесса покупки)

## Пул: Система интернет-магазина

### Основной поток

1. START (Получение заказа от покупателя)
2. Проверка наличия товара
3. XOR_SPLIT (условие: наличие товара)
   - ЕСЛИ товар в наличии:
     4a. Резервирование товара
     5a. AND_SPLIT
        - ПАРАЛЛЕЛЬНО:
          6a. Формирование накладной
          6b. Отправка информации в службу доставки
     7a. AND_JOIN
     8a. Ожидание способа оплаты
     9a. XOR_SPLIT (условие: способ оплаты)
        - ЕСЛИ онлайн оплата:
          10a. Обработка онлайн платежа
        - ИНАЧЕ оплата при получении:
          10b. Пропуск обработки платежа
     11a. Создание заказа
     12a. Уведомление покупателя
     13a. Ожидание подтверждения доставки
     14a. Закрытие заказа
   - ИНАЧЕ товара нет в наличии:
     4b. Предложение альтернативных товаров
5. END (Завершение обработки заказа)

## Пул: Служба доставки

### Основной поток

1. START (Получение заказа от системы)
2. Планирование маршрута доставки
3. Доставка товара покупателю
4. END (Завершение доставки)

## Связи между пулами

### MessageFlow связи:
- Покупатель.Оформление заказа → Система.Получение заказа
- Система.Уведомление → Покупатель.Выбор способа оплаты
- Покупатель.Онлайн оплата → Система.Обработка платежа
- Покупатель.Оплата при получении → Доставка.Доставка товара
- Доставка.Доставка товара → Покупатель.Подтверждение получения
- Покупатель.Подтверждение получения → Система.Закрытие заказа

## Элементы

### События:
- START: start_pokupatel, start_sistema, start_dostavka
- END: end_pokupatel, end_sistema, end_dostavka
- Промежуточные: event_uvedomlenie

### Задачи:
- Покупатель: task_vybor_tovarov, task_oformlenie_zakaza, task_vybor_oplaty, task_oplata_pri_poluchenii, task_podtverzhdenie_polucheniya
- Система: task_proverka_nalichiya, task_rezerv_tovara, task_predlozhenie_alternativ, task_formirovanie_nakladnoy, task_otpravka_v_dostavku, task_obrabotka_platezha, task_sozdanie_zakaza, task_zakrytie_zakaza
- Доставка: task_planirovanie_marshruta, task_dostavka_tovara

### Гейтвеи:
- XOR: gateway_nalichie, gateway_vybor_oplaty
- AND: gateway_parallel_split, gateway_parallel_join

### MessageFlow:
- message_flow_1 до message_flow_7