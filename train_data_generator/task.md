1) Цель и итоговые артефакты
- Цель: создать большой, разнообразный, валидный и детерминированно аннотированный датасет BPMN-диаграмм для SFT/финетюнинга Qwen‑3 VLM.
- Основная пара для обучения: PNG-изображение диаграммы и целевой текст-ответ (формализованное описание алгоритма).
- Дополнительно для контроля качества и воспроизводимости сохраняются:
  - исходный BPMN XML,
  - IR JSON (граф: узлы/связи/типы/координаты),
  - JSON метаданные генерации (seed, конфиг, стили, используемые шрифты, язык, сложность, сценарий),

1) Охват BPMN (минимум и расширения)
- Базовый обязательный поднабор (этап 1):
  - StartEvent, EndEvent
  - Task (Task/UserTask/ServiceTask как один тип Task на этапе 1)
  - Exclusive Gateway (XOR), Parallel Gateway (AND)
  - SequenceFlow (с подписью и без)
- Расширение (этап 2, сложные диаграммы):
  - SubProcess (collapsed/expanded)
  - Intermediate Events: Timer, Message (intermediateCatch/Throw)
  - Boundary Events (Timer/Message) и прерывание
  - Lanes/Pools, MessageFlow между пулами
  - Event-Based Gateway (по возможности)
  - CallActivity (опционально)
- Ограничения корректности:
  - хотя бы один Start и один End на процесс,
  - граф связный по SequenceFlow внутри процесса,
  - парность сплит/джойн для AND, корректность ветвлений XOR,
  - для пулов — отсутствие межпроцессных sequence flow (только message flow).

1) Общая архитектура и компоненты
- `./basic` простой python генератор изображений и их описания для обучения модели базовым строительным блокам BPMN диаграмм
- `./LLM-gen` генератор на базе внешних LLM который строит уже комплексные BPMN диаграммы отражающие реальные бизнес задачи
- `./transformer` преобразовывает и проверяет выходные от basic и LLM XML файлы в png фото, а так же немного их меняет

2) Этап 1. Правильная генерация базовых структур (хорошо написанный python генератор базовых обьектов и связей)
- Генератор графов (грамматика):
  - Линейная цепочка: Start → Task{n} → End.
  - Ветвление XOR: Start → Task → XOR split → (Task A | Task B) → XOR join → Task → End.
  - Параллельность AND: Start → AND split → (Task A || Task B) → AND join → End.
  - Цикл: Start → Task → XOR split (repeat? yes/no) → End или возврат к Task.
  - Комбинации: вложение одного паттерна в другой до заданной глубины (depth ≤ 2 для этапа 1).
- Наполнение текстов:
  - Словари действий/объектов/условий для RU/EN (например: Проверить/Validate, Заказ/Order, Оплачен?/Paid?).
  - Генерация меток веток: “да/нет”, “yes/no”, “>= N”, “ok/fail”.
  - Псевдослучайный выбор формулировок с контролем частот.
- Генерация текста-описания (детерминированно из XML):
  - Стиль “шаги”: нумерация, линейные шаги, ветки if/else с явными условиями, параллельные секции с маркировкой.
  - Стиль “псевдокод”: структурные блоки IF/ELSE/WHILE/FORK-JOIN.
- Цель по объёму этапа 1:
  - 1 тыс. примеров, сбалансированных по типам паттернов.

1) Этап 2. Генерация осмысленных диаграмм (директория `/LLM-gen`, полностью независимый от `/basic` код)
- Источник сценариев:
  - Вариант A (внешний API): промпт к LLM с требованиями к сложности, домену (финансы/логистика/hr/it), числу пулов/лейнов, типам событий, наличию сабпроцессов, boundary events, message flow. Ответ — BPMN 2.0 XML + краткий нарратив.
  - В модель мы подаем промпт описание диаграммы которую хотим получить (прим "диаграмма взаимодействия пользователя и продавца при покупке товара в магазине"), будет отдельная директория с входными запросами в формате md файлов (для примерна можно создать 5 штук)
  - на выходе получаем XML код диаграммы и текстовое описание диаграммы в формате markdown
  - настраивать ответ модели можно с помощью системного промпта
- Параметры сложности:
  - Узлы: 10–40,
  - Пулы: 1–3, лейны: 1–5,
  - Количество типов событий: 1–3 разных вида,
  - Сабпроцессы: до 2 уровней вложенности,
  - Сообщения: 1–6 message flow.
- Качество:
  - Автопочинка XML (обязательные атрибуты, namespace), повторная валидация.
  - Отбраковка, если не проходят графовые проверки.
- Цель по объёму этапа 2:
  - 100 примеров, с доменными сценарием и разнообразным стилем.

1) Текст-описание (ground truth) (нужно для basic и LLM модели)
- Языки: RU и EN (настраиваемое соотношение).
- Два формата ответа:
  - Steps: “1) Старт. 2) Выполнить X. 3) Если Y: … иначе … 4) Параллельно: … 5) Конец.”
  - Pseudocode: структурный IF/ELSE/WHILE/FORK/JOIN, без CoT.
- Референс-генератор:
  - Учитывает подписи на стрелках и узлах; если пусто — генерирует нейтральные (“Выполнить задачу N”).
  - Для message flow явно указывает взаимодействие между пулами.

1) Рендеринг BPMN → PNG (отдельная диреткория `/transformer` в которой отдельное приложение рендерит XML в PNG BPMN диаграмму), это нужно для того чтобы не дублировать код между базовой python и LLM генерацией
- Стилизация и разнообразие (настраивается в config файле):
  - DPI/разрешение: длинная сторона 1024–2048 px.
  - Цветовые темы: светлая/тёмная/контрастная, случайные палитры в допустимых пределах.
  - Шрифты (OFL/Apache): Noto Sans/Serif, Roboto, Open Sans, Inter, Fira Sans; случайный выбор.
  - Толщина линий, размеры иконок, скругление, отступы, межстрочные интервалы.
  - Случайные смещения меток, повороты ±2°, зум/панорамирование для частичных полей.
  - Лёгкие: JPEG-артефакты, гауссово размытие, легкий шум, тонкий поворот, яркость/контраст, тон-маппинг, лёгкая дисторсия перспективы.
- на выходе получаем PNG изображение и его `.BPMN` копию, а так же файл с параметрами генерации PNG изображения (данные о разрешении, теме, повороте и так далее)
